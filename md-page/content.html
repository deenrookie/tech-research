<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Markdown 文档在线预览</title>

<!-- 
https://github.com/chjj/marked
-->
<script src="res/jquery-3.1.1.min.js"></script>
<script src="res/vue-2.0.3.js"></script>
<link rel="stylesheet" href="res/doc.css" charset="utf-8">
<script src="res/marked.js"></script>

<!-- 
http://www.ghostchina.com/adding-syntax-highlighting-to-ghost-using-highlight-js/
-->
<link href="res/monokai_sublime.min.css" rel="stylesheet">  
<script src="res/highlight.min.js"></script> 

</head>
<body>

<div class="header" id="header">
	<h1>{{ title }}</h1>
	<div class="menu">
		<a v-for="item in menu" v-bind:href="item.id" v-bind:class="item.isActive" v-on:click="trans(item)">{{ item.text}}</a>
	</div>
</div>
<div id="content" class="doc-content"></div>
<script>
(function(){
	var _file = "example/example.md";
	$.get(_file, function(response, status, xhr){ 
		renderMD(response);
	});
})();

function renderMD(md){
	var _html = marked(md);
	$("#content").html(_html);

	// 页面 title
	var title = $("#content h1").html();
	document.title = title;

	// 顶部菜单
	var menu = [];

	$("#content h2").each(function(index){
		var id = "menu-" + index;
		var isActive = "no";
		if(index == 0){
			isActive = "hover";
		}
		$(this).attr("id", id);

		menu.push({
			text: $(this).text(),
			id: "#" + id,
			isActive: isActive
		});
	});
	var header = new Vue({
		el : "#header",
		data : {
			title : title,
			menu : menu
		},
		methods: {
			trans: function(item){
				for(var i=0;i<this.menu.length;i++){
					this.menu[i].isActive = "no";
					if(this.menu[i].id == item.id){
						this.menu[i].isActive = "hover";
					}
				}
			}
		}
	});

	//代码高亮
	$('pre > code').each(function(i, block) {
		hljs.highlightBlock(block);
	});	

	// 滚动
	$(window).scroll(function(){
		var top = $(window).scrollTop();
		if(top >= 92){
			$(".menu").addClass("menu-top");
		}else{
			$(".menu").removeClass("menu-top");			
		}
	});
}
</script>

</body>
</html>