<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Web SDK test</title>
</head>
<body>
<style>
body{
	font-size:14px;
	line-height:2;
	color:#333;
}
.panel span{
	display:inline-block;
	width:60px;
}
#show{
	display:none;
	border:1px solid #ccc;
	padding:10px 30px;
	max-width:400px;
}	
</style>

<div class="panel">
	<p>
		<span>appkey</span>
		<input type="text" id="appkey" size="20" value="x18ywvqf8gfsc">
	</p>
	<p>
		<span>token</span>
		<input type="text" id="token" size="120" value="1zeLnJxyIVaGezN5VxPyEpdoByu7GozBEcdVLbxYdYUXfQhIOJlmWXUQCyHbW0e4A95+QY8X/AyC+6YTtTw79w==">
	</p>
	<p>
		<span>&#160;</span>
		<input type="button" onclick="run()" value="开始测试">
	</p>
</div>

<ol id="show"></ol>

<script>
var dom = document.getElementById("show");
function showTips(data){
	dom.innerHTML += "<li>" + data + "</li>";
}	
</script>

<script src="//cdn.ronghub.com/RongIMLib-2.2.4.min.js"></script>
<script>
function run(){
	var appKey = document.getElementById("appkey").value;
	var token = document.getElementById("token").value;

	if(appkey == "" || token == ""){
		alert("必须提供appkey和token");
	}

	dom.innerHTML = "";
	dom.style.display = "block";

	//初始化
	RongIMLib.RongIMClient.init(appKey);
	showTips("开始初始化");

	// 连接状态监听器
	RongIMClient.setConnectionStatusListener({
		onChanged: function (status) {
		    switch (status) {
		        case RongIMLib.ConnectionStatus.CONNECTED:
		            showTips("链接成功")
		            break;
		        case RongIMLib.ConnectionStatus.CONNECTING:
		            showTips('正在链接');
		            break;
		        case RongIMLib.ConnectionStatus.DISCONNECTED:
		            showTips('断开连接');
		            break;
		        case RongIMLib.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:
		            showTips('其他设备登录');
		            break;
		          case RongIMLib.ConnectionStatus.DOMAIN_INCORRECT:
		            showTips('域名不正确');
		            break;
		        case RongIMLib.ConnectionStatus.NETWORK_UNAVAILABLE:
		        	showTips('网络不可用');
		        	break;
		        }
		}
	});

	// 消息监听器
	RongIMClient.setOnReceiveMessageListener({
		// 接收到的消息
		onReceived: function (message) {
		    // 判断消息类型
		    showTips("新消息，类型为：" + message.messageType);
		    switch(message.messageType){
		        case RongIMClient.MessageType.TextMessage:
		            break;
		        case RongIMClient.MessageType.VoiceMessage:
		            // 对声音进行预加载                
		            // message.content.content 格式为 AMR 格式的 base64 码
		            break;
		        case RongIMClient.MessageType.ImageMessage:
		           // message.content.content => 图片缩略图 base64。
		           // message.content.imageUri => 原图 URL。
		           break;
		        case RongIMClient.MessageType.DiscussionNotificationMessage:
		           // message.content.extension => 讨论组中的人员。
		           break;
		        case RongIMClient.MessageType.LocationMessage:
		           // message.content.latiude => 纬度。
		           // message.content.longitude => 经度。
		           // message.content.content => 位置图片 base64。
		           break;
		        case RongIMClient.MessageType.RichContentMessage:
		           // message.content.content => 文本消息内容。
		           // message.content.imageUri => 图片 base64。
		           // message.content.url => 原图 URL。
		           break;
		        case RongIMClient.MessageType.InformationNotificationMessage:
		            // do something...
		           break;
		        case RongIMClient.MessageType.ContactNotificationMessage:
		            // do something...
		           break;
		        case RongIMClient.MessageType.ProfileNotificationMessage:
		            // do something...
		           break;
		        case RongIMClient.MessageType.CommandNotificationMessage:
		            // do something...
		           break;
		        case RongIMClient.MessageType.CommandMessage:
		            // do something...
		           break;
		        case RongIMClient.MessageType.UnknownMessage:
		            // do something...
		           break;
		        default:
		            // do something...
		    }
		}
	});


	RongIMClient.connect(token, {
		onSuccess: function(userId) {
			showTips("链接成功，用户id：" + userId);
		},
		onTokenIncorrect: function() {
			//console.log('token无效');
		},
		onError:function(errorCode){
		  var info = '';
		  switch (errorCode) {
		    case RongIMLib.ErrorCode.TIMEOUT:
		      info = '超时';
		      break;
		    case RongIMLib.ErrorCode.UNKNOWN_ERROR:
		      info = '未知错误';
		      break;
		    case RongIMLib.ErrorCode.UNACCEPTABLE_PaROTOCOL_VERSION:
		      info = '不可接受的协议版本';
		      break;
		    case RongIMLib.ErrorCode.IDENTIFIER_REJECTED:
		      info = 'appkey不正确';
		      break;
		    case RongIMLib.ErrorCode.SERVER_UNAVAILABLE:
		      info = '服务器不可用';
		      break;
		  }
		  showTips(info);
		}
	});
}
</script>
	
</body>
</html>